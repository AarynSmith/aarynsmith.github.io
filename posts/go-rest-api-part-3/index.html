<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Go REST API (Part 3) - Aaryn Smith</title><meta name=Description content="Aaryn Smith"><meta property="og:title" content="Go REST API (Part 3)"><meta property="og:description" content="In this post we are going to expand on our REST API server enabling methods for replacing a user using PUT and updating a user using both PATCH."><meta property="og:type" content="article"><meta property="og:url" content="https://aarynsmith.com/posts/go-rest-api-part-3/"><meta property="og:image" content="https://aarynsmith.com/logo.png"><meta property="article:published_time" content="2018-04-30T00:00:00+00:00"><meta property="article:modified_time" content="2018-04-30T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://aarynsmith.com/logo.png"><meta name=twitter:title content="Go REST API (Part 3)"><meta name=twitter:description content="In this post we are going to expand on our REST API server enabling methods for replacing a user using PUT and updating a user using both PATCH."><meta name=application-name content="Aaryn Smith"><meta name=apple-mobile-web-app-title content="Aaryn Smith"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://aarynsmith.com/posts/go-rest-api-part-3/><link rel=prev href=https://aarynsmith.com/posts/go-rest-api-part-2/><link rel=next href=https://aarynsmith.com/posts/go-rest-api-part-4/><link rel=stylesheet href=/lib/normalize/normalize.min.055364f5be272caa092b0e6654c165828707f8ab971e2656383a6d6392bc345e.css integrity="sha256-BVNk9b4nLKoJKw5mVMFlgocH+KuXHiZWODptY5K8NF4="><link rel=stylesheet href=/css/style.min.2537da3a877022fb783322b88b497954c6248b3da171c8cb2d97a620c8254ba6.css integrity="sha256-JTfaOodwIvt4MyK4i0l5VMYkiz2hccjLLZemIMglS6Y="><link rel=stylesheet href=/lib/fontawesome-free/all.min.876d023d9d10c97941b80c3b03e2a5b94631ff7a4af9cee5604a6a2d39718d84.css integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ="><link rel=stylesheet href=/lib/animate/animate.min.3c770e90f98eb21b0c042fafb49755af93306fbaf42e449524f94fae9fc83295.css integrity="sha256-PHcOkPmOshsMBC+vtJdVr5Mwb7r0LkSVJPlPrp/IMpU="><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Go REST API (Part 3)","inLanguage":"","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/aarynsmith.com\/posts\/go-rest-api-part-3\/"},"genre":"posts","keywords":"Go, REST, api","wordcount":959,"url":"https:\/\/aarynsmith.com\/posts\/go-rest-api-part-3\/","datePublished":"2018-04-30T00:00:00+00:00","dateModified":"2018-04-30T00:00:00+00:00","publisher":{"@type":"Organization","name":"Aaryn Smith"},"author":{"@type":"Person","name":"Aaryn Smith"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Aaryn Smith">Aaryn Smith</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/resume/>Resumé </a><a class=menu-item href=/pages/about-me>About </a><a class=menu-item href=/posts/>Blog </a><a class=menu-item href=/projects/>Projects </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Aaryn Smith">Aaryn Smith</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/resume/>Resumé</a><a class=menu-item href=/pages/about-me>About</a><a class=menu-item href=/posts/>Blog</a><a class=menu-item href=/projects/>Projects</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Go REST API (Part 3)</h1><h2 class=single-subtitle>More endpoints for REST Server</h2><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Aaryn Smith</a></span>&nbsp;<span class=post-category>included in <a href=/categories/blog/><i class="far fa-folder fa-fw"></i>Blog</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2018-04-30>2018-04-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;959 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#replacing-users>Replacing Users</a></li><li><a href=#patching-a-user>Patching a user</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><div class=content id=content><p>In this post we are going to expand on our REST API server enabling methods for replacing a user using PUT and updating a user using both PATCH.</p><h2 id=replacing-users>Replacing Users</h2><p>We&rsquo;ll start off similar to our other methods by adding an new handler, and function for PUT. Replacing a user is going to be very similar to our <code>CreateUser</code> function, however we&rsquo;ll need to make sure the user exists before replacing it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=nx>App</span><span class=p>)</span> <span class=nf>Run</span><span class=p>(</span><span class=nx>addr</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Listening on %v&#34;</span><span class=p>,</span> <span class=nx>addr</span><span class=p>)</span>
    <span class=nx>a</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/user/{id:[0-9]+}&#34;</span><span class=p>,</span> <span class=nx>a</span><span class=p>.</span><span class=nx>GetUser</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;GET&#34;</span><span class=p>)</span>
    <span class=nx>a</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/user&#34;</span><span class=p>,</span> <span class=nx>a</span><span class=p>.</span><span class=nx>CreateUser</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;POST&#34;</span><span class=p>)</span>
    <span class=nx>a</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/user/{id:[0-9]+}&#34;</span><span class=p>,</span> <span class=nx>a</span><span class=p>.</span><span class=nx>ReplaceUser</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;PUT&#34;</span><span class=p>)</span>
    <span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=nx>addr</span><span class=p>,</span> <span class=nx>a</span><span class=p>.</span><span class=nx>Router</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=nx>app</span><span class=p>)</span> <span class=nf>ReplaceUser</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>req</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>vars</span> <span class=o>:=</span> <span class=nx>mux</span><span class=p>.</span><span class=nf>Vars</span><span class=p>(</span><span class=nx>req</span><span class=p>)</span>
    <span class=nx>id</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>Atoi</span><span class=p>(</span><span class=nx>vars</span><span class=p>[</span><span class=s>&#34;id&#34;</span><span class=p>])</span>
    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
        <span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span>
        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;Could not delete user: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
        <span class=k>return</span>
    <span class=p>}</span>
    <span class=nx>p</span> <span class=o>:=</span> <span class=nx>user</span><span class=p>{}</span>
    <span class=nx>buf</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
    <span class=nx>buf</span><span class=p>.</span><span class=nf>ReadFrom</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>Body</span><span class=p>)</span>
    <span class=nx>err</span> <span class=p>=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Unmarshal</span><span class=p>(</span><span class=nx>buf</span><span class=p>.</span><span class=nf>Bytes</span><span class=p>(),</span> <span class=o>&amp;</span><span class=nx>p</span><span class=p>)</span>
    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
        <span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span>
        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;500 Internal Server Error\n&#34;</span><span class=p>)</span>
        <span class=k>return</span>
    <span class=p>}</span>
    <span class=nx>_</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>a</span><span class=p>.</span><span class=nx>UserDB</span><span class=p>[</span><span class=nx>id</span><span class=p>]</span>
    <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
        <span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=mi>404</span><span class=p>)</span>
        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;404 page not found\n&#34;</span><span class=p>)</span>
        <span class=k>return</span>
    <span class=p>}</span>
    <span class=nx>p</span><span class=p>.</span><span class=nx>ID</span> <span class=p>=</span> <span class=nx>id</span>
    <span class=nx>a</span><span class=p>.</span><span class=nx>UserDB</span><span class=p>[</span><span class=nx>id</span><span class=p>]</span> <span class=p>=</span> <span class=nx>p</span>
    <span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>This is a simple method that takes the ID from the URL requested and assigns any incoming data to the user in the database. For updating a user with PATCH we&rsquo;ll have to check all the provided data in the request body and add them one by one.</p><p>Testing this method with curl is very similar to what we&rsquo;ve seen previously, using the -X PUT flags.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ curl -i -X PUT http://127.0.0.1:3001/user/1 -d<span class=s1>&#39;{&#34;name&#34;: &#34;User 2&#34;,&#34;role&#34;:&#34;User&#34;}&#39;</span>
HTTP/1.1 <span class=m>200</span> OK
Content-Length: <span class=m>0</span>
Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8

$ curl -i -X GET http://127.0.0.1:3001/user/1
HTTP/1.1 <span class=m>200</span> OK
Content-Length: <span class=m>34</span>
Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8

<span class=o>{</span><span class=s2>&#34;ID&#34;</span>:1,<span class=s2>&#34;Name&#34;</span>:<span class=s2>&#34;User 2&#34;</span>,<span class=s2>&#34;Role&#34;</span>:<span class=s2>&#34;User&#34;</span><span class=o>}</span>
</code></pre></td></tr></table></div></div><p>That being said, one potential issue with this method, is it by design will replace a user, not update it. So, if you pass only part of a user, such as a new name, it will not populate the role for the user. See below:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ curl -i -X PUT http://127.0.0.1:3001/user/1 -d<span class=s1>&#39;{&#34;name&#34;: &#34;User 2&#34;}&#39;</span>
HTTP/1.1 <span class=m>200</span> OK
Content-Length: <span class=m>0</span>
Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8

$ curl -i -X GET http://127.0.0.1:3001/user/1
HTTP/1.1 <span class=m>200</span> OK
Content-Length: <span class=m>34</span>
Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8

<span class=o>{</span><span class=s2>&#34;ID&#34;</span>:1,<span class=s2>&#34;Name&#34;</span>:<span class=s2>&#34;User 2&#34;</span>,<span class=s2>&#34;Role&#34;</span>:<span class=s2>&#34;&#34;</span><span class=o>}</span>
</code></pre></td></tr></table></div></div><p>In order to only change part of a user instead of submitting all of the data for the user to be replaced, we want to use the PATCH method.</p><h2 id=patching-a-user>Patching a user</h2><p>Patching a user is generally more useful to update certain elements of a user rather than outright replacing the user in whole. For this we&rsquo;ll need to check the incoming request body data for the items that have been provided. We&rsquo;ll then update the current entry with the newly provided updates.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=nx>app</span><span class=p>)</span> <span class=nf>Run</span><span class=p>(</span><span class=nx>addr</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Listening on %v&#34;</span><span class=p>,</span> <span class=nx>addr</span><span class=p>)</span>
    <span class=nx>a</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/userdb&#34;</span><span class=p>,</span> <span class=nx>a</span><span class=p>.</span><span class=nx>DumpDB</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;GET&#34;</span><span class=p>)</span>
    <span class=nx>a</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/user/{id:[0-9]+}&#34;</span><span class=p>,</span> <span class=nx>a</span><span class=p>.</span><span class=nx>GetUser</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;GET&#34;</span><span class=p>)</span>
    <span class=nx>a</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/user&#34;</span><span class=p>,</span> <span class=nx>a</span><span class=p>.</span><span class=nx>CreateUser</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;POST&#34;</span><span class=p>)</span>
    <span class=nx>a</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/user/{id:[0-9]+}&#34;</span><span class=p>,</span> <span class=nx>a</span><span class=p>.</span><span class=nx>DeleteUser</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;DELETE&#34;</span><span class=p>)</span>
    <span class=nx>a</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/user/{id:[0-9]+}&#34;</span><span class=p>,</span> <span class=nx>a</span><span class=p>.</span><span class=nx>ReplaceUser</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;PUT&#34;</span><span class=p>)</span>
    <span class=nx>a</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/user/{id:[0-9]+}&#34;</span><span class=p>,</span> <span class=nx>a</span><span class=p>.</span><span class=nx>UpdateUser</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;PATCH&#34;</span><span class=p>)</span>
    <span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=nx>addr</span><span class=p>,</span> <span class=nx>a</span><span class=p>.</span><span class=nx>Router</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=nx>app</span><span class=p>)</span> <span class=nf>UpdateUser</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>req</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>vars</span> <span class=o>:=</span> <span class=nx>mux</span><span class=p>.</span><span class=nf>Vars</span><span class=p>(</span><span class=nx>req</span><span class=p>)</span>
    <span class=nx>id</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>Atoi</span><span class=p>(</span><span class=nx>vars</span><span class=p>[</span><span class=s>&#34;id&#34;</span><span class=p>])</span>
    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
        <span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span>
        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;Could not delete user: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
        <span class=k>return</span>
    <span class=p>}</span>
    <span class=nx>pNew</span> <span class=o>:=</span> <span class=nx>user</span><span class=p>{}</span>
    <span class=nx>buf</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
    <span class=nx>buf</span><span class=p>.</span><span class=nf>ReadFrom</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>Body</span><span class=p>)</span>
    <span class=nx>err</span> <span class=p>=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Unmarshal</span><span class=p>(</span><span class=nx>buf</span><span class=p>.</span><span class=nf>Bytes</span><span class=p>(),</span> <span class=o>&amp;</span><span class=nx>pNew</span><span class=p>)</span>
    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
        <span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span>
        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;500 Internal Server Error\n&#34;</span><span class=p>)</span>
        <span class=k>return</span>
    <span class=p>}</span>
    <span class=nx>_</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>a</span><span class=p>.</span><span class=nx>UserDB</span><span class=p>[</span><span class=nx>id</span><span class=p>]</span>
    <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
        <span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=mi>404</span><span class=p>)</span>
        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;404 page not found\n&#34;</span><span class=p>)</span>
        <span class=k>return</span>
    <span class=p>}</span>
    <span class=nx>pNew</span><span class=p>.</span><span class=nx>ID</span> <span class=p>=</span> <span class=nx>id</span>
    <span class=k>if</span> <span class=nx>pNew</span><span class=p>.</span><span class=nx>Name</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
        <span class=nx>pNew</span><span class=p>.</span><span class=nx>Name</span> <span class=p>=</span> <span class=nx>a</span><span class=p>.</span><span class=nx>UserDB</span><span class=p>[</span><span class=nx>id</span><span class=p>].</span><span class=nx>Name</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=nx>pNew</span><span class=p>.</span><span class=nx>Role</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
        <span class=nx>pNew</span><span class=p>.</span><span class=nx>Role</span> <span class=p>=</span> <span class=nx>a</span><span class=p>.</span><span class=nx>UserDB</span><span class=p>[</span><span class=nx>id</span><span class=p>].</span><span class=nx>Role</span>
    <span class=p>}</span>
    <span class=nx>a</span><span class=p>.</span><span class=nx>UserDB</span><span class=p>[</span><span class=nx>id</span><span class=p>]</span> <span class=p>=</span> <span class=nx>pNew</span>
    <span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>Here you can see we unmarshal the incoming request body into an object called <code>pNew</code> and check to make sure the provided ID exists in the database. Once those have been verified, we check each of the struct fields from the incoming data to see if they have updated data, if they do not, they will be empty strings, since each of our struct fields are strings. If an incoming field is empty, we replace it with the data from the existing user information in the database, then overwrite the existing database entry with the updated one.</p><p>Let&rsquo;s try out our new method with curl using the -X PATCH flags.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ curl -i -X GET http://127.0.0.1:3001/user/1
HTTP/1.1 <span class=m>200</span> OK
Content-Length: <span class=m>39</span>
Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8

<span class=o>{</span><span class=s2>&#34;ID&#34;</span>:1,<span class=s2>&#34;Name&#34;</span>:<span class=s2>&#34;User 1&#34;</span>,<span class=s2>&#34;Role&#34;</span>:<span class=s2>&#34;Admin&#34;</span><span class=o>}</span>

$ curl -i -X PATCH http://127.0.0.1:3001/user/1 -d<span class=s1>&#39;{&#34;name&#34;: &#34;User 2&#34;}&#39;</span>
HTTP/1.1 <span class=m>200</span> OK
Content-Length: <span class=m>0</span>
Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8

$ curl -i -X GET http://127.0.0.1:3001/user/1
HTTP/1.1 <span class=m>200</span> OK
Content-Length: <span class=m>34</span>
Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8

<span class=o>{</span><span class=s2>&#34;ID&#34;</span>:1,<span class=s2>&#34;Name&#34;</span>:<span class=s2>&#34;User 2&#34;</span>,<span class=s2>&#34;Role&#34;</span>:<span class=s2>&#34;Admin&#34;</span><span class=o>}</span>

$ curl -i -X PATCH http://127.0.0.1:3001/user/1 -d<span class=s1>&#39;{&#34;role&#34;: &#34;User&#34;}&#39;</span>
HTTP/1.1 <span class=m>200</span> OK
Content-Length: <span class=m>0</span>
Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8

$ curl -i -X GET http://127.0.0.1:3001/user/1
HTTP/1.1 <span class=m>200</span> OK
Content-Length: <span class=m>38</span>
Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8

<span class=o>{</span><span class=s2>&#34;ID&#34;</span>:1,<span class=s2>&#34;Name&#34;</span>:<span class=s2>&#34;User 2&#34;</span>,<span class=s2>&#34;Role&#34;</span>:<span class=s2>&#34;User&#34;</span><span class=o>}</span>
</code></pre></td></tr></table></div></div><p>Here we see the first PATCH request changes user ID 1&rsquo;s name from &ldquo;User 1&rdquo; to &ldquo;User 2&rdquo; and the second request changes the user&rsquo;s role from &ldquo;Admin&rdquo; to &ldquo;User&rdquo;.</p><h2 id=conclusion>Conclusion</h2><p>We&rsquo;ve expanded on our server adding the ability replace and update users. Woo! We&rsquo;ve got a mostly working API now. Next we&rsquo;ll add some tests to our project to verify all our API endpoints perform the way we expect them to work.</p><p>Here is a gist of our <a href=https://gist.github.com/AarynSmith/2f09d3d2eace746e77e96c8f2ecf60c1#file-main-go target=_blank rel="noopener noreffer">main.go</a> from this post.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2018-04-30</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/go/>Go</a>,&nbsp;<a href=/tags/rest/>REST</a>,&nbsp;<a href=/tags/api/>api</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/go-rest-api-part-2/ class=prev rel=prev title="Go REST API (Part 2)"><i class="fas fa-angle-left fa-fw"></i>Go REST API (Part 2)</a>
<a href=/posts/go-rest-api-part-4/ class=next rel=next title="Go REST API (Part 4)">Go REST API (Part 4)<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Aaryn Smith</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.4710034e669c7ff17f823f9ba12cf8a36582d65b007f79cbc4a3c11d7db2e4ca.css integrity="sha256-RxADTmacf/F/gj+boSz4o2WC1lsAf3nLxKPBHX2y5Mo="><link rel=stylesheet href=/lib/katex/copy-tex.min.bf9ff4137fec38f6255419e142d0883c9c52090885d746f80eee12b273d9b3e0.css integrity="sha256-v5/0E3/sOPYlVBnhQtCIPJxSCQiF10b4Du4SsnPZs+A="><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.bcff85fb5e00d68802850b393ac7792c997f722f536f38e26638c46dca8e5eb6.js integrity="sha256-vP+F+14A1ogChQs5Osd5LJl/ci9TbzjiZjjEbcqOXrY="></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.fb649fcae62177dfe63e67081ddceb830b5ce1f05a4184e9bbb7d87ac4b8f4e5.js integrity="sha256-+2SfyuYhd9/mPmcIHdzrgwtc4fBaQYTpu7fYesS49OU="></script><script type=text/javascript src=/lib/clipboard/clipboard.min.8a7739925f4c03586479852df840b7061948832a7fda30c8c812d2ea4dd4c4f2.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI="></script><script type=text/javascript src=/lib/katex/katex.min.17f5dd6b9f123dd7140abfb18521b3f4c036cd004f6f40121182a8865f140877.js integrity="sha256-F/Xda58SPdcUCr+xhSGz9MA2zQBPb0ASEYKohl8UCHc="></script><script type=text/javascript src=/lib/katex/auto-render.min.f74776a677f0d2be0af0264058f928e2ba455d0b19bc985304660d922a43a6b2.js integrity="sha256-90d2pnfw0r4K8CZAWPko4rpFXQsZvJhTBGYNkipDprI="></script><script type=text/javascript src=/lib/katex/copy-tex.min.2ab2237329021bc443986c8327f6e61357fb68a54e5d233d224023718c02207d.js integrity="sha256-KrIjcykCG8RDmGyDJ/bmE1f7aKVOXSM9IkAjcYwCIH0="></script><script type=text/javascript src=/lib/katex/mhchem.min.5cea356d6025c5a2f18c454c83ec5674dbb04fab1cd1d75569e77788c6b6f888.js integrity="sha256-XOo1bWAlxaLxjEVMg+xWdNuwT6sc0ddVaed3iMa2+Ig="></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":1000},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"$$","right":"$$"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"},{"display":false,"left":"$","right":"$"}],"strict":false}};</script><script type=text/javascript src=/js/theme.min.f51938f3065a40ee841bcb558e4330e31fd26c0ea55343fff8770b88b0319a3c.js integrity="sha256-9Rk48wZaQO6EG8tVjkMw4x/SbA6lU0P/+HcLiLAxmjw="></script></body></html>